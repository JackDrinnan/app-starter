<link rel="import" href="../../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="/src/header.html">
<dom-module id="login-register-page">
<template>
  <style include="app-styles">
    :host {
      display: block;
      max-width: 400px;
      margin: 0 auto;
    }
    .divider {
      margin: 8px 24px;
      @apply --font-small;
      text-align: center;
      position: relative;
      background-color: var(--light-primary-color);
      color: #fff;
      height: inherit;
    }
  </style>

  <paper-material>

    <div hidden$="[[!auth]]">
      You are already logged in.
    </div>

    <div hidden$="[[auth]]">
      <paper-input
        id="username"
        required
        autofocus
        auto-validate
        label="Username"
        allowed-pattern="[a-zA-Z0-9_\\-]"
        minlength="4"
        maxlength="16">
      </paper-input>
      <paper-input
        id="password"
        type="password"
        required
        auto-validate
        label="Password"
        minlength="6"
        maxlength="32">
      </paper-input>
      <paper-input
        id="passwordRepeat"
        hidden$="[[!register]]"
        type="password"
        required
        auto-validate
        label="Confirm password"
        minlength="6"
        maxlength="32">
      </paper-input>

      <div class="layout horizontal center-justified">
        <paper-button
          raised
          class="primary-button"
          id="loginRegisterButton"
          on-tap="_loginRegister"
          data-provider="username">
          [[toggleString(register, 'Register', 'Sign In')]]
        </paper-button>
      </div>

      <div class="divider">
        <span>Or login using</span>
      </div>

      <div class="font-small layout horizontal wrap around-justified">
        <div class="layout vertical center"
          on-tap="_loginRegister"
          data-provider="google">
          <iron-image src="/images/google-icon.svg"></iron-image>
          Google
        </div>
        <div class="layout vertical center"
          on-tap="_loginRegister"
          data-provider="facebook">
          <iron-image src="/images/facebook-icon.svg"></iron-image>
          Facebook
        </div>
        <div class="layout vertical center"
          on-tap="_loginRegister"
          data-provider="twitter">
          <iron-image src="/images/twitter-icon.svg"></iron-image>
          Twitter
        </div>
        <div class="layout vertical center"
          on-tap="_loginRegister"
          data-provider="github">
          <iron-image src="/images/github-icon.svg"></iron-image>
          Github
        </div>
      </div>
    </div>

    </div>
  </paper-material>
</template>
<script>
class LoginRegisterPage extends Polymer.Element {
  static get is() { return 'login-register-page'; }
  static get config() {
    return { /* properties, observers meta data */
      properties: {
        auth: Object,
        register: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        }
      }
    }
  }
  constructor() {
    super();
  }
  connectedCallback() {
    super.connectedCallback();
  }

  _loginRegister(e) {
    var el = e.tartget || e.srcElement;
    var data = {};
    data.provider = el.dataset.provider;

    if (data.provider == 'username') {
      data.isRegistering = this.register;
      if (this._validateInput()) {
        data.username = this.$.username.value;
        data.password = this.$.password.value;
      } else {
        return;
      }
    }

    // LOG && log.v('firing login-register', data);
    fire(this, 'login-register', data);
  }

  _validateInput() {
    var user = this.$.username.value;
    var pass = this.$.password.value;
    var pass2 = this.$.passwordRepeat.value;

    if (!user || user.length < 4 || user.length > 16) {
      this.$.username.invalid = true;
      return false;
    }
    if (!pass || pass.length < 6 || pass.length > 32) {
      this.$.password.invalid = true;
      return false;
    }
    if (this.register) {
      if (!pass2 || pass2.length < 6 || pass2.length > 32) {
        this.$.passwordRepeat.invalid = true;
        return false;
      }
      if (pass != pass2) {
        this.$.password.invalid = true;
        this.$.passwordRepeat.invalid = true;
        return false;
      }
    }
    return true;
  }

  // TODO behavior
  toggleString(condition, ifTrue, ifFalse) {
    return condition ? ifTrue : ifFalse;
  }
}
// Register custom element definition using standard platform API
customElements.define(LoginRegisterPage.is, LoginRegisterPage);
</script>
</dom-module>
