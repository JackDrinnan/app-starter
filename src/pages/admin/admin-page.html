<link rel="import" href="../../../bower_components/paper-material/paper-material.html">
<link rel="import" href="/src/header.html">

<dom-module id="admin-page">
  <template>
    <style include="app-styles">
      :host {
        display: block;
      }
    </style>

    <paper-material>
      <div hidden$="[[hasRoot]]">
        The root user is not defined yet.
        <paper-button
          class="primary-button"
          on-tap="becomeRoot">
          Become Root
        </paper-button>
      </div>

      <div hidden$="[[hasAccess]]">
        You do not have permission to view this page.
      </div>

      <dom-if if="[[hasAccess]]">
        <template>
        <div class="font-title">Welcome</div>
        <div>[[auth.profile.name]]</div>
        </template>
      </dom-if>
    </paper-material>
  </template>

  <script>
    class AdminPage extends Polymer.Element {
      static get is() { return 'admin-page'; }
      static get config() {
        return { /* properties, observers meta data */
          properties: {
            auth: {
              type: Object,
              observer: '_authChanged'
            },
            hasRoot: {
              type: Boolean,
              value: true,
              readOnly: true
            },
            hasAccess: {
              type: Boolean,
              value: false,
              computed: '_hasAccess(auth, hasRoot)'
            }
          }
        }
      }
      constructor() {
        super();
      }
      connectedCallback() {
        super.connectedCallback();
      }

      _authChanged(auth, prev) {
        if (auth && !prev) {
          db.read('/roles/hasRoot', function(hasRoot) {
            this._setHasRoot(!isEmpty(hasRoot));
          }, this);
        }
      }

      _hasAccess(auth, hasRoot) {
        return hasRoot && hasChild(auth, 'user', 'isElevated') && auth.user.isElevated;
      }

      becomeRoot() {
        db.admin.becomeRoot(this.auth.name, function () {
          showSuccessToast('You are now root.');
        }, function () {
          showErrorToast('Failed to become root.');
        });
      }
    }
    // Register custom element definition using standard platform API
    customElements.define(AdminPage.is, AdminPage);
  </script>
</dom-module>
