<link rel="import" href="../../../bower_components/paper-material/paper-material.html">
<link rel="import" href="/src/header.html">

<dom-module id="admin-page">
  <template>
    <style include="app-styles">
      :host {
        display: block;
      }
    </style>

    <paper-material>
      <div hidden$="[[hasRoot]]">
        The root user is not defined yet.
        <paper-button
          class="primary-button"
          on-tap="becomeRoot">
          Become Root
        </paper-button>
      </div>

      <div hidden$="[[hasAccess]]">
        You do not have permission to view this page.
      </div>

      <dom-if if="[[hasAccess]]">
        <template>
        <div class="font-headline">Welcome</div>
        <div>[[auth.profile.name]]</div>
        </template>
      </dom-if>
    </paper-material>
  </template>

  <script>
  Polymer({
    is: 'admin-page',
    properties: {
      auth: {
        type: Object,
        observer: '_authChanged'
      },
      hasRoot: {
        type: Boolean,
        value: true,
        readOnly: true
      },
      hasAccess: {
        type: Boolean,
        value: false,
        computed: '_hasAccess(auth, hasRoot)'
      }
    },

    _authChanged: function(auth, prev) {
      if (auth && !prev) {
        db.watch('/roles/hasRoot', function(hasRoot) {
          this._setHasRoot(!isEmpty(hasRoot));
        }.bind(this));
      }
    },

    _hasAccess: function(auth, hasRoot) {
      return auth && (!hasRoot || (auth.user && auth.user.isElevated));
    },

    becomeRoot: function() {
      db.admin.becomeRoot(this.auth.uid, function () {
        showSuccessToast('You are now root.');
      }, function () {
        showErrorToast('Failed to become root.');
      });
    }
  });
  </script>
</dom-module>
